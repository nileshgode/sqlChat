
# LangGraph SQL Agent with Streamlit UI

This project demonstrates a robust, stateful AI agent capable of answering natural language questions about a SQL database. The agent is built using **LangGraph** for creating a predictable, structured workflow and **Streamlit** for a user-friendly web interface.

The core of this project is a resilient agent architecture that follows a strict, linear sequence of operations, ensuring reliable and accurate results. It is designed to be compatible with various LLMs, including local models via Ollama and proprietary models like OpenAI's GPT series.

## üåü Key Features

*   **Natural Language to SQL**: Ask questions in plain English (e.g., "Which artist has the most albums?") and get a precise answer from your database.
*   **Structured Agent Workflow**: Utilizes a custom state object and a rigid graph structure in LangGraph to ensure a predictable and debuggable execution flow: `Get Schema` -> `Generate Query` -> `Execute Query` -> `Summarize Result`.
*   **Modular Architecture**: The code is organized into logical modules for UI (`app.py`), agent logic (`app/agent.py`), LLM configuration (`app/llm_config.py`), and utilities (`app/utils.py`).
*   **Interactive UI**: A simple and clean web interface built with Streamlit allows users to easily configure the LLM, specify a database URI, and interact with the agent.
*   **LLM Flexibility**: Easily switch between local models (via Ollama) and cloud-based models (like OpenAI) through a simple dropdown menu.

***

## üèõÔ∏è Project Architecture

The application is designed with a clear separation of concerns to promote maintainability and scalability.

```
sql-agent-streamlit/
|
‚îú‚îÄ‚îÄ üìÇ app/
|   ‚îú‚îÄ‚îÄ üìÑ agent.py         # Defines the LangGraph agent, its custom state, and execution nodes.
|   ‚îú‚îÄ‚îÄ üìÑ llm_config.py      # Handles LLM provider selection and initialization.
|   ‚îî‚îÄ‚îÄ üìÑ utils.py           # Manages the database connection.
|
‚îú‚îÄ‚îÄ üìÑ app.py               # The main Streamlit application file that handles the UI.
|
‚îî‚îÄ‚îÄ üìÑ README.md            # This file.
```

### Workflow Logic

The LangGraph agent follows a non-cyclical, four-step process:
1.  **Get Schema**: Retrieves the database schema to provide context to the LLM.
2.  **Generate Query**: The LLM generates a SQL query based on the user's question and the schema.
3.  **Execute Query**: The generated SQL query is executed against the database.
4.  **Summarize Result**: The LLM receives the result of the query and formulates a final, natural language answer for the user.

This structured approach prevents common agent failures like hallucination, context loss, and infinite loops.

***

## üöÄ Getting Started

Follow these steps to set up and run the project locally.

### 1. Prerequisites

*   Python 3.9 or higher.
*   An API key for OpenAI (if you wish to use GPT models).
*   [Ollama](https://ollama.com/) installed and running locally (if you wish to use local models).

### 2. Clone the Repository

First, get the project code on your local machine.
```bash
git clone <your-repository-url>
cd sql-agent-streamlit
```

### 3. Set Up a Virtual Environment

It is highly recommended to use a virtual environment to manage project dependencies.

```bash
# Create a virtual environment
python -m venv venv

# Activate the virtual environment
# On Windows:
venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate
```

### 4. Install Dependencies

Create a `requirements.txt` file in the project root with the following content:

```text
streamlit
langchain
langgraph
langchain-community
langchain-ollama
langchain-openai
requests
```

Then, install all required packages using pip:

```bash
pip install -r requirements.txt
```

### 5. Configure Your Environment (Optional)

*   **For OpenAI**: If you plan to use OpenAI models, you must set your API key as an environment variable.
    ```bash
    # On Windows (Command Prompt)
    set OPENAI_API_KEY="your-api-key"

    # On macOS/Linux
    export OPENAI_API_KEY="your-api-key"
    ```

*   **For Ollama**:
    1.  Ensure the Ollama application is running on your machine.
    2.  Pull a model that is good at following instructions. We recommend `llama3.1`.
        ```bash
        ollama pull llama3.1
        ```

### 6. Run the Application

Once your environment is set up and dependencies are installed, you can launch the Streamlit application.

```bash
streamlit run app.py
```

Your web browser should automatically open a new tab with the application running at `http://localhost:8501`.

### 7. How to Use the App

1.  **Select LLM Provider**: Use the dropdown in the sidebar to choose between `ollama` or `openai`.
2.  **Provide Database URI**: Enter the connection string for your database. The default is `sqlite:///Chinook.db`. If this file doesn't exist, the application will automatically download the sample Chinook database for you.
3.  **Ask a Question**: Type your question in the chat input at the bottom of the page and press Enter.

The agent will begin processing your request, and you will see the final answer appear in the chat interface.

***
## üõ†Ô∏è Code Files

For reference, the project consists of the following key files:

*   **`app.py`**: The main entry point for the Streamlit application.
*   **`app/agent.py`**: Contains the core logic for the LangGraph agent, including the custom `AgentState` and the definitions for all nodes in the graph.
*   **`app/llm_config.py`**: A simple module to abstract away the LLM initialization, allowing for easy switching between providers.
*   **`app/utils.py`**: A utility module to handle database connections.

[1](https://langchain-ai.github.io/langgraph/tutorials/sql/sql-agent/)
[2](https://github.com/langchain-ai/langgraph)
[3](https://github.com/wassim249/fastapi-langgraph-agent-production-ready-template)
[4](https://langchain-ai.github.io/langgraph/examples/)
[5](https://python.langchain.com/docs/tutorials/sql_qa/)
[6](https://www.reddit.com/r/LangChain/comments/1kr7c3a/built_a_natural_language_sql_agent_with_langgraph/)
[7](https://www.ibm.com/think/tutorials/build-sql-agent-langgraph-mistral-medium-3-watsonx-ai)
[8](https://www.projectpro.io/article/langgraph-projects-and-examples/1124)
[9](https://www.youtube.com/watch?v=mNxAM1ETBvs)